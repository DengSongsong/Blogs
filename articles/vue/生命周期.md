#生命周期解析过程

## callHook
<p>
生命周期其实就是在源码的某个时间点执行了callHook方法来调用vm.$options的生命周期钩子方法
</p>

```
// vue/src/core/instance/lifecycle.js
export function callHook (vm: Component, hook: string) {
  const handlers = vm.$options[hook] // 获取Vue选项中的生命周期钩子函数
  if (handlers) {
    for (let i = 0, j = handlers.length; i < j; i++) {
      try {
        handlers[i].call(vm) // 执行生命周期函数
      } catch (e) {
        handleError(e, vm, `${hook} hook`)
      }
    }
  }
  if (vm._hasHookEvent) {
    vm.$emit('hook:' + hook)
  }
  popTarget()
}
```
<p>
例如触发created钩子的方法：callHook(vm, 'created')
</p>

## new Vue()
### 创建Vue对象，通过构造函数的形式创建

```
// vue/src/core/instance/index.js
function Vue (options) {
  if (process.env.NODE_ENV !== 'production' &&
    !(this instanceof Vue)
  ) { //判断是否是通过new关键字创建Vue对象
    warn('Vue is a constructor and should be called with the `new` keyword')
  }
  this._init(options) // 初始化各个功能
}
```
### this._init()
// vue/src/core/instance/init.js
```
 Vue.prototype._init = function (options?: Object) {
    /* istanbul ignore else */
    if (process.env.NODE_ENV !== 'production') {
      initProxy(vm)
    } else {
      vm._renderProxy = vm
    }
    // expose real self
    vm._self = vm
    initLifecycle(vm) //初始化生命周期
    initEvents(vm) //初始化事件
    initRender(vm) //初始化渲染
    callHook(vm, 'beforeCreate') //触发beforeCreate钩子
    initInjections(vm) // resolve injections before data/props 初始化Inject
    initState(vm) //初始化数据
    initProvide(vm) // resolve provide after data/props 初始化Provide
    callHook(vm, 'created') //触发created钩子

    if (vm.$options.el) {
      vm.$mount(vm.$options.el)
    }
  }
```
### 整个初始化过程中大致做的事情：
* initLifecycle(vm) //初始化生命周期
* initEvents(vm)  //初始化事件
* initRender(vm)  //初始化渲染
* callHook(vm, 'beforeCreate') //触发beforeCreate钩子
* initInjections(vm) // resolve injections before data/props 初始化Inject
* initState(vm) //初始化数据
* initProvide(vm) // resolve provide after data/props 初始化Provide
* callHook(vm, 'created') //触发created钩子

## Init Events && Lifecycle
<p>初始化事件和周期周期发生在创建Vue对象的过程中并在触发beforeCreate钩子之前，此过程还包含了初始化渲染</p>

### Init Events

```
// vue/src/core/instance/events.js
export function initEvents (vm: Component) {
  vm._events = Object.create(null)
  vm._hasHookEvent = false
  // init parent attached events
  const listeners = vm.$options._parentListeners
  if (listeners) {
    updateComponentListeners(vm, listeners)
  }
}
```
<p>该方法初始化事件的相关属性：on、off、emit</p>

### Init Lifecycle

```
export function initLifecycle (vm: Component) {
  const options = vm.$options

  // locate first non-abstract parent
  let parent = options.parent
  if (parent && !options.abstract) {
    while (parent.$options.abstract && parent.$parent) {
      parent = parent.$parent
    }
    parent.$children.push(vm)
  }

  vm.$parent = parent
  vm.$root = parent ? parent.$root : vm

  vm.$children = []
  vm.$refs = {}

  vm._watcher = null
  vm._inactive = null
  vm._directInactive = false
  vm._isMounted = false
  vm._isDestroyed = false
  vm._isBeingDestroyed = false
}
```
<p>
该方法主要是为vm对象添加了$parent、$root、$children、$refs等属性，以及一些其它的生命周期相关的标识
</p>

## beforeCreate()

## Init injections && reactivity

## created()

## beforeMount()

## mounted()

## beforeUpdate()

## updated()

## beforeDestory()

## destroyed()